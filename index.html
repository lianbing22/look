<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ’æ³°è§†è§‰ AI è¯†åˆ«ç³»ç»Ÿ - å®æ—¶ç‰©ä½“è¯†åˆ«</title>
    <meta name="description" content="æ’æ³°è§†è§‰AIè¯†åˆ«ç³»ç»Ÿæ˜¯ä¸€æ¬¾åŸºäºTensorFlow.jsçš„å®æ—¶ç‰©ä½“è¯†åˆ«åº”ç”¨ï¼Œæ”¯æŒ80å¤šç§å¸¸è§ç‰©ä½“çš„æ£€æµ‹ï¼Œæ— éœ€å®‰è£…å³å¯åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ã€‚">
    <meta name="keywords" content="AIè¯†åˆ«,ç‰©ä½“æ£€æµ‹,TensorFlow.js,è®¡ç®—æœºè§†è§‰,äººå·¥æ™ºèƒ½,æœºå™¨å­¦ä¹ ,å®æ—¶è¯†åˆ«">
    <meta name="author" content="æ’æ³°ç§‘æŠ€">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourwebsite.com/">
    <meta property="og:title" content="æ’æ³°è§†è§‰ AI è¯†åˆ«ç³»ç»Ÿ">
    <meta property="og:description" content="åœ¨æµè§ˆå™¨ä¸­å®æ—¶è¯†åˆ«æ‘„åƒå¤´ä¸­çš„80å¤šç§ç‰©ä½“ï¼Œæ— éœ€å®‰è£…ï¼Œç®€å•æ˜“ç”¨ã€‚">
    <meta property="og:image" content="icons/icon-512x512.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://yourwebsite.com/">
    <meta property="twitter:title" content="æ’æ³°è§†è§‰ AI è¯†åˆ«ç³»ç»Ÿ">
    <meta property="twitter:description" content="åœ¨æµè§ˆå™¨ä¸­å®æ—¶è¯†åˆ«æ‘„åƒå¤´ä¸­çš„80å¤šç§ç‰©ä½“ï¼Œæ— éœ€å®‰è£…ï¼Œç®€å•æ˜“ç”¨ã€‚">
    <meta property="twitter:image" content="icons/icon-512x512.png">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- ç¦æ­¢è‡ªåŠ¨ç”µè¯å·ç è¯†åˆ«å’Œé“¾æ¥ -->
    <meta name="format-detection" content="telephone=no">
    
    <!-- iOS Web App Mode -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æ’æ³°è§†è§‰">
    
    <!-- iOSå›¾æ ‡ -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/icon-152x152.png">
    
    <!-- å¯åŠ¨ç”»é¢ -->
    <link rel="apple-touch-startup-image" href="icons/icon-512x512.png">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#0a1429">
    
    <link rel="stylesheet" href="style.css">
    <!-- TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0"></script>
    <!-- COCO-SSD æ¨¡å‹ -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2"></script>
    
    <!-- iOSç‰¹æ®Šå¤„ç† -->
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
    
    <!-- é˜»æ­¢æµè§ˆå™¨å¯¹æ¨¡å‹çš„CORSæ£€æŸ¥ -->
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta http-equiv="Access-Control-Allow-Headers" content="*">

    <!-- é¢å¤–çš„iOSæ¸²æŸ“ä¼˜åŒ– -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <!-- å¼ºåˆ¶ä½¿ç”¨æœ€æ–°æ¸²æŸ“å¼•æ“ -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <!-- ç¦ç”¨è‡ªåŠ¨æ”¾å¤§ -->
    <style>
        html {
            -webkit-text-size-adjust: 100%;
        }
        /* é˜²æ­¢iOS Safariä¸­çš„åŒè§†é¢‘é—®é¢˜ */
        video, canvas {
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }
    </style>
</head>
<body>
    <header>
        <h1>æ’æ³°è§†è§‰ AI è¯†åˆ«ç³»ç»Ÿ</h1>
        <nav>
            <a href="#" class="active">é¦–é¡µ</a>
            <a href="admin/index.html">ç®¡ç†</a>
            <a href="#" id="helpBtn">å¸®åŠ©</a>
        </nav>
    </header>

    <main>
        <div class="container">
            <!-- å®Œå…¨é‡æ„è§†é¢‘å®¹å™¨ï¼Œä½¿ç”¨æœ€ç®€å•çš„ç»“æ„ -->
            <div class="camera-container" id="cameraContainer">
                <!-- åªä¿ç•™å¿…è¦çš„å…ƒç´ ï¼Œç®€åŒ–ç»“æ„ -->
                <video id="video" autoplay playsinline muted></video>
                <canvas id="canvas"></canvas>
                <!-- å ä½ç¬¦å’ŒåŠ è½½æŒ‡ç¤ºå™¨ -->
                <div id="cameraPlaceholder" class="camera-placeholder">
                    <div>
                        <div class="loading-spinner"></div>
                        <span>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹</span>
                    </div>
                </div>
            </div>
            <div class="controls">
                <button id="startBtn">å¼€å§‹è¯†åˆ«</button>
                <button id="stopBtn" disabled>åœæ­¢è¯†åˆ«</button>
                <button id="saveBtn" disabled>ä¿å­˜ç»“æœ</button>
            </div>
            <div class="results">
                <h2>è¯†åˆ«ç»“æœ <a href="#" id="historyBtn" class="history-link" title="æŸ¥çœ‹å†å²è®°å½•"><i class="history-icon">ğŸ“‹</i></a></h2>
                <div id="predictions"></div>
            </div>
        </div>
    </main>
    
    <!-- å¸®åŠ©å¼•å¯¼è¦†ç›–å±‚ -->
    <div id="helpOverlay" class="help-overlay">
        <div class="help-content">
            <h2>ä½¿ç”¨æŒ‡å—</h2>
            <button id="closeHelpBtn" class="close-btn">&times;</button>
            
            <div class="help-steps">
                <div class="help-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>å¼€å§‹ä½¿ç”¨</h3>
                        <p>ç‚¹å‡»"å¼€å§‹è¯†åˆ«"æŒ‰é’®å¯åŠ¨æ‘„åƒå¤´å¹¶è¿›è¡Œå®æ—¶ç‰©ä½“è¯†åˆ«ã€‚é¦–æ¬¡ä½¿ç”¨æ—¶ï¼Œæµè§ˆå™¨ä¼šè¯·æ±‚æ‘„åƒå¤´æƒé™ï¼Œè¯·ç‚¹å‡»"å…è®¸"ã€‚</p>
                    </div>
                </div>
                
                <div class="help-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>è¯†åˆ«ç‰©ä½“</h3>
                        <p>å°†æ‘„åƒå¤´å¯¹å‡†æ‚¨æƒ³è¦è¯†åˆ«çš„ç‰©ä½“ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ç”»é¢ä¸­çš„ç‰©ä½“ï¼Œå¹¶åœ¨å³ä¾§æ˜¾ç¤ºè¯†åˆ«ç»“æœã€‚</p>
                    </div>
                </div>
                
                <div class="help-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>è°ƒæ•´è®¾ç½®</h3>
                        <p>ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ ä¸­çš„"ç®¡ç†"æŒ‰é’®ï¼Œå¯ä»¥è°ƒæ•´è¯†åˆ«é˜ˆå€¼ã€æœ€å¤§è¯†åˆ«æ•°é‡ç­‰å‚æ•°ï¼Œæ ¹æ®æ‚¨çš„éœ€æ±‚è¿›è¡Œè‡ªå®šä¹‰ã€‚</p>
                    </div>
                </div>
                
                <div class="help-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>ç»“æŸè¯†åˆ«</h3>
                        <p>è¯†åˆ«å®Œæˆåï¼Œç‚¹å‡»"åœæ­¢è¯†åˆ«"æŒ‰é’®å…³é—­æ‘„åƒå¤´å¹¶ç»“æŸè¯†åˆ«è¿‡ç¨‹ã€‚</p>
                    </div>
                </div>
            </div>
            
            <div class="help-tips">
                <h3>å°è´´å£«</h3>
                <ul>
                    <li>ç¡®ä¿ç¯å¢ƒå…‰çº¿å……è¶³ï¼Œä»¥æé«˜è¯†åˆ«å‡†ç¡®ç‡</li>
                    <li>å°½é‡ä¿æŒç‰©ä½“åœ¨ç”»é¢ä¸­å¿ƒä½ç½®</li>
                    <li>æ¯æ¬¡è¯†åˆ«æœ€å¤šå¯åŒæ—¶æ£€æµ‹10ä¸ªç‰©ä½“ï¼ˆå¯åœ¨ç®¡ç†è®¾ç½®ä¸­è°ƒæ•´ï¼‰</li>
                    <li>ç³»ç»Ÿå¯è¯†åˆ«80ç§å¸¸è§ç‰©ä½“ï¼ŒåŒ…æ‹¬äººã€åŠ¨ç‰©ã€äº¤é€šå·¥å…·ã€å®¶å…·ã€ç”µå­è®¾å¤‡ç­‰</li>
                </ul>
            </div>
            
            <button id="startTutorialBtn" class="tutorial-btn">æŸ¥çœ‹è¯¦ç»†æ•™ç¨‹</button>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 æ’æ³°è§†è§‰ AI è¯†åˆ«ç³»ç»Ÿ | <a href="https://github.com/yourusername/hengtai-vision" target="_blank" rel="noopener">GitHub</a></p>
    </footer>

    <script src="script.js"></script>
    
    <!-- ç¦»çº¿å·¥ä½œæ”¯æŒ -->
    <script>
        // æ³¨å†ŒService Workerï¼ˆå¦‚æœæµè§ˆå™¨æ”¯æŒï¼‰
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // å…ˆå°è¯•æ³¨é”€æ—§çš„Service Worker
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    for(let registration of registrations) {
                        registration.unregister().then(success => {
                            console.log('Service Worker æ³¨é”€æˆåŠŸ:', success);
                        }).catch(error => {
                            console.log('Service Worker æ³¨é”€å¤±è´¥:', error);
                        });
                    }
                    
                    // å†æ³¨å†Œæ–°çš„Service Worker
                    setTimeout(() => {
                        navigator.serviceWorker.register('service-worker.js')
                            .then(registration => {
                                console.log('Service Worker æ³¨å†ŒæˆåŠŸ:', registration.scope);
                            })
                            .catch(error => {
                                console.log('Service Worker æ³¨å†Œå¤±è´¥:', error);
                            });
                    }, 1000);
                });
            });
        }
    </script>
    
    <!-- å†å²è®°å½•é¢æ¿ -->
    <div id="historyPanel" class="history-panel">
        <div class="history-header">
            <h3>è¯†åˆ«å†å²è®°å½•</h3>
            <button id="historyCloseBtn" class="history-close">&times;</button>
        </div>
        <div id="historyContent" class="history-content">
            <!-- å†å²è®°å½•é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            <div class="history-empty">æš‚æ— ä¿å­˜çš„è¯†åˆ«è®°å½•</div>
        </div>
        <button id="historyClearBtn" class="history-clear">æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•</button>
    </div>
    
    <!-- ä¿å­˜å¯¹è¯æ¡† -->
    <div id="saveDialog" class="save-dialog">
        <div class="save-dialog-content">
            <h3>ä¿å­˜è¯†åˆ«ç»“æœ</h3>
            <img id="savePreview" class="save-preview" src="" alt="é¢„è§ˆå›¾">
            <div class="save-form-group">
                <label for="saveName">åç§°</label>
                <input type="text" id="saveName" placeholder="ä¸ºæ­¤è¯†åˆ«ç»“æœå‘½å">
            </div>
            <div class="save-dialog-actions">
                <button id="cancelSaveBtn" class="save-dialog-btn cancel">å–æ¶ˆ</button>
                <button id="confirmSaveBtn" class="save-dialog-btn save">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ é”™è¯¯å¤„ç†è„šæœ¬ -->
    <script>
        // æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(event) {
            console.error('å…¨å±€é”™è¯¯:', event.message);
            if (event.message && event.message.includes('tfjs') || event.message.includes('tensorflow')) {
                // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
                const loadingIndicator = document.querySelector('.loading-indicator') || document.getElementById('cameraPlaceholder');
                if (loadingIndicator) {
                    loadingIndicator.innerHTML = `
                        <div style="color: white; background-color: rgba(220, 53, 69, 0.9); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-weight: bold; margin-bottom: 10px;">æ¨¡å‹åŠ è½½å¤±è´¥</div>
                            <div style="font-size: 14px;">è¯·å°è¯•ä½¿ç”¨Safariæµè§ˆå™¨æˆ–åˆ·æ–°é¡µé¢é‡è¯•</div>
                        </div>
                    `;
                }
            }
        });
    </script>

    <!-- æ·»åŠ Safariå»ºè®®æç¤º -->
    <div id="safariSuggestion" style="display: none; position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background-color: rgba(255, 159, 64, 0.95); color: white; padding: 10px 15px; border-radius: 8px; z-index: 2000; text-align: center; max-width: 90%; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
        <div style="font-weight: bold; margin-bottom: 5px;">æ¨èä½¿ç”¨Safariæµè§ˆå™¨</div>
        <div style="font-size: 14px;">åœ¨iOSè®¾å¤‡ä¸Šï¼ŒSafariæµè§ˆå™¨æä¾›æ›´å¥½çš„AIæ¨¡å‹æ”¯æŒ</div>
        <button id="dismissSafariTip" style="margin-top: 8px; background: rgba(255,255,255,0.3); border: none; color: white; padding: 5px 10px; border-radius: 4px;">æˆ‘çŸ¥é“äº†</button>
    </div>

    <script>
    // æ£€æµ‹iOS Chromeå¹¶æ˜¾ç¤ºSafariå»ºè®®
    (function() {
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isChrome = /CriOS/.test(navigator.userAgent);
        if (isIOS && isChrome) {
            // iOSä¸Šçš„Chromeæµè§ˆå™¨
            setTimeout(() => {
                const suggestion = document.getElementById('safariSuggestion');
                suggestion.style.display = 'block';
                
                // ç‚¹å‡»å…³é—­æŒ‰é’®éšè—æç¤º
                document.getElementById('dismissSafariTip').addEventListener('click', () => {
                    suggestion.style.display = 'none';
                    // è®°ä½ç”¨æˆ·å·²å…³é—­æç¤º
                    localStorage.setItem('safariSuggestionDismissed', 'true');
                });
            }, 2000);
        }
    })();
    </script>

    <!-- iOSè§†é¢‘ä¿®å¤è„šæœ¬ -->
    <script>
    (function() {
        // æ£€æµ‹iOSè®¾å¤‡
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        
        if (isIOS) {
            // ä¸“é—¨é’ˆå¯¹iOSè®¾å¤‡çš„ä¿®å¤
            document.addEventListener('DOMContentLoaded', function() {
                const video = document.getElementById('video');
                const canvas = document.getElementById('canvas');
                const cameraContainer = document.getElementById('cameraContainer');
                
                // ç§»é™¤ä»»ä½•å¤šä½™çš„è§†é¢‘å…ƒç´ 
                cameraContainer.querySelectorAll('video').forEach((v, index) => {
                    if (index > 0 || v.id !== 'video') {
                        v.parentNode.removeChild(v);
                    }
                });
                
                // ç¡®ä¿è§†é¢‘å’Œç”»å¸ƒä½¿ç”¨ç»å¯¹å®šä½å¹¶å®Œå…¨è¦†ç›–
                video.style.position = 'absolute';
                video.style.top = '0';
                video.style.left = '0';
                video.style.width = '100%';
                video.style.height = '100%';
                video.style.objectFit = 'cover';
                video.style.zIndex = '1';
                
                canvas.style.position = 'absolute';
                canvas.style.top = '0';
                canvas.style.left = '0';
                canvas.style.width = '100%';
                canvas.style.height = '100%';
                canvas.style.zIndex = '2';
                
                // ç¦ç”¨iOSä¸­å¯èƒ½å¯¼è‡´é—®é¢˜çš„åŠŸèƒ½
                video.setAttribute('playsinline', '');
                video.setAttribute('muted', '');
                video.setAttribute('autoplay', '');
            });
        }
    })();
    </script>
</body>
</html> 